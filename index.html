<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twoje Zaproszenie - Zdrapka</title>
    <style>
        /* Styl dla kontenera, aby utrzymać pozycjonowanie */
       #scratch-container {
    position: relative;
    /* Domyślne wymiary (usunięte, bo kolidują z max-width) */
    
    /* KLUCZOWA ZMIANA: OGRANICZENIE SZEROKOŚCI */
    max-width: 600px; /* Maksymalna szerokość kontenera na stronie */
    width: 90%;      /* Użyj 90% dostępnej szerokości na mniejszych ekranach */
    height: auto;    /* Wysokość jest automatyczna */
    
    margin: 50px auto;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.7); 
    border-radius: 10px;
    overflow: hidden;
}

        /* Obrazek, który ma się odsłonić */
        #scratchImage {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }

        /* Płótno (warstwa do zdrapywania) */
        #scratchCanvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: pointer;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <h1 style="text-align: center; color: #333;">Odkryj niespodziankę!</h1>

    <div id="scratch-container">
        <img id="scratchImage" src="zaproszenie.png" alt="Zaproszenie" width="300" height="200" />
        
        <canvas id="scratchCanvas"></canvas>
    </div>
    
    <p style="text-align: center; margin-top: 20px; color: #555;">Zacznij klikać i przeciągać, aby zdrapać warstwę.</p>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('scratch-container');
            const canvas = document.getElementById('scratchCanvas');
            const ctx = canvas.getContext('2d');
            const imageToReveal = document.getElementById('scratchImage');

            let isScratching = false;
            let WIDTH, HEIGHT; // Zmienne na wymiary

            // ----------------------------------------------------
            // GŁÓWNA LOGIKA ŁADOWANIA I SKALOWANIA
            // ----------------------------------------------------

            const image = new Image();
            image.src = imageToReveal.src; 

image.onload = () => {
                // ... (reszta kodu)

                // WAŻNE: Wymiary WIDTH i HEIGHT, których użyjemy do canvas, 
                // powinny być pobrane z kontenera, który jest już wyskalowany przez CSS!

                // Pobieramy rzeczywiste, wyskalowane wymiary kontenera
                const rect = container.getBoundingClientRect();
                WIDTH = rect.width;
                HEIGHT = rect.height;

                canvas.width = WIDTH;
                canvas.height = HEIGHT;
                
                // NIE NADPISUJEMY JUŻ STYLÓW kontenera, bo zrobil to CSS:
                // container.style.width = `${WIDTH}px`;
                // container.style.height = `${HEIGHT}px`;

                // Po ustaleniu wymiarów inicjujemy warstwę zdrapki
                initializeScratchLayer(WIDTH, HEIGHT);
            };
            
            // ----------------------------------------------------
            // FUNKCJE POMOCNICZE
            // ----------------------------------------------------

            function initializeScratchLayer(W, H) {
                // Używamy koloru złotego!
                ctx.fillStyle = '#FFD700'; 
                ctx.fillRect(0, 0, W, H);
                
                // Dodaj tekst "ZDRAP!"
                ctx.font = '24px Arial'; 
                ctx.fillStyle = '#A88400'; 
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ZDRAP!', W / 2, H / 2);

                // Konfiguracja "gumki"
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 30; 
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
            }
            
            // Pobiera współrzędne w kontekście canvas
            function getCoords(e) {
                const rect = canvas.getBoundingClientRect();
                let clientX, clientY;

                if (e.touches) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            }

            // Rozpoczyna zdrapywanie
            function startScratch(e) {
                e.preventDefault(); 
                isScratching = true;
                const { x, y } = getCoords(e);
                
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(x + 1, y + 1); 
                ctx.stroke();
            }

            // Kontynuuje zdrapywanie
            function scratch(e) {
                if (!isScratching) return;
                e.preventDefault();
                const { x, y } = getCoords(e);
                
                ctx.lineTo(x, y);
                ctx.stroke();
            }

            // Kończy zdrapywanie
            function stopScratch() {
                isScratching = false;
                ctx.closePath();
            }
            
            // ----------------------------------------------------
            // PODPINANIE OBSŁUGI ZDARZEŃ
            // ----------------------------------------------------
            
            // Myszka
            canvas.addEventListener('mousedown', startScratch);
            canvas.addEventListener('mousemove', scratch);
            document.addEventListener('mouseup', stopScratch);

            // Dotyk (dla urządzeń mobilnych)
            canvas.addEventListener('touchstart', startScratch);
            canvas.addEventListener('touchmove', scratch);
            document.addEventListener('touchend', stopScratch);
        });
    </script>
</body>
</html>

