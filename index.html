<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twoje Zaproszenie - Zdrapka</title>
    <style>
        /* Styl dla kontenera, aby utrzymać pozycjonowanie */
        #scratch-container {
            position: relative;
            width: 300px; /* Ustaw szerokość taką samą jak w JS */
            height: 200px; /* Ustaw wysokość taką samą jak w JS */
            margin: 50px auto; /* Wyśrodkowanie na stronie */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden; /* Ważne, aby krawędzie były równe */
        }

        /* Styl dla obrazu, który ma być "zdrapany" */
        #scratchImage {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }

        /* Styl dla płótna (warstwy do zdrapywania) */
        #scratchCanvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: pointer;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <h1 style="text-align: center; color: #333;">Odkryj niespodziankę!</h1>

    <div id="scratch-container">
        <img id="scratchImage" src="zaproszenie.png" alt="Zaproszenie" width="300" height="200" />
        
        <canvas id="scratchCanvas"></canvas>
    </div>
    
    <p style="text-align: center; margin-top: 20px; color: #555;">Zacznij klikać i przeciągać, aby zdrapać warstwę.</p>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('scratch-container');
            const canvas = document.getElementById('scratchCanvas');
            const ctx = canvas.getContext('2d');
            const imageToReveal = document.getElementById('scratchImage');

            // Ustawienia rozmiaru: Ważne, aby były takie same jak w CSS i atrybutach <img>
            const WIDTH = 300;
            const HEIGHT = 200;

            canvas.width = WIDTH;
            canvas.height = HEIGHT;
            
            // Flaga do sprawdzania, czy użytkownik "zdrapuje"
            let isScratching = false;

            // 1. FUNKCJA INICJALIZUJĄCA "ZDRAPKĘ"
            function initializeScratchLayer() {
                // Rysujemy warstwę w kolorze szarym, która ma być zdrapywana
                ctx.fillStyle = '#ccc'; // Jasnoszary kolor
                ctx.fillRect(0, 0, WIDTH, HEIGHT);
                
                // Opcjonalnie: Dodaj tekst lub wzorek na warstwie
                ctx.font = '20px Arial';
                ctx.fillStyle = '#555';
                ctx.textAlign = 'center';
                ctx.fillText('ZDRAP!', WIDTH / 2, HEIGHT / 2);

                // Konfiguracja "gumki"
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 25; // Szerokość pędzla
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
            }

            // 2. FUNKCJE OBSŁUGI ZDARZEŃ (MYSZKA I DOTYK)

            // Pobiera współrzędne w kontekście canvas
            function getCoords(e) {
                const rect = canvas.getBoundingClientRect();
                let clientX, clientY;

                // Sprawdzanie, czy to zdarzenie dotyku
                if (e.touches) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            }

            // Rozpoczyna zdrapywanie
            function startScratch(e) {
                e.preventDefault(); // Zapobiega przesuwaniu strony na urządzeniach mobilnych
                isScratching = true;
                const { x, y } = getCoords(e);
                
                // Rozpocznij ścieżkę i natychmiast ją narysuj (aby działało dla pojedynczego kliknięcia)
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(x + 1, y + 1); // Rysowanie krótkiej linii
                ctx.stroke();
            }

            // Kontynuuje zdrapywanie
            function scratch(e) {
                if (!isScratching) return;
                e.preventDefault();
                const { x, y } = getCoords(e);
                
                ctx.lineTo(x, y);
                ctx.stroke();
            }

            // Kończy zdrapywanie
            function stopScratch() {
                isScratching = false;
                // Zakończenie ścieżki
                ctx.closePath();
            }
            
            // 3. PODPINANIE OBSŁUGI ZDARZEŃ
            
            // Myszka
            canvas.addEventListener('mousedown', startScratch);
            canvas.addEventListener('mousemove', scratch);
            document.addEventListener('mouseup', stopScratch);

            // Dotyk (dla urządzeń mobilnych)
            canvas.addEventListener('touchstart', startScratch);
            canvas.addEventListener('touchmove', scratch);
            document.addEventListener('touchend', stopScratch);
            
            // 4. INICJALIZACJA
            initializeScratchLayer();

            console.log("Kod zdrapki załadowany. Sprawdź, czy plik zaproszenie.png jest w tym samym folderze.");
        });
    </script>
</body>
</html>
